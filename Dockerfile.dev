ARG DB_HOST
ARG DB_PORT
ARG DB_NAME
ARG DB_USERNAME
ARG DB_PWD
ARG APP_PORT
ARG APP_DATA_MODE
ARG APP_DB
ARG APP_DB_DRIVER
ARG APP_DEBUG

FROM maven:3.9.8-eclipse-temurin-22-alpine

 ENV DB_HOST=${DB_HOST}
 ENV DB_PORT=${DB_PORT}
 ENV DB_NAME=${DB_NAME}
 ENV DB_USERNAME=${DB_USERNAME}
 ENV DB_PWD=${DB_PWD}
 ENV APP_PORT=${APP_PORT}
 ENV APP_DATA_MODE=${APP_DATA_MODE}
 ENV APP_DB=${APP_DB}
 ENV APP_DB_DRIVER=${APP_DB_DRIVER}
 ENV APP_DEBUG=${APP_DEBUG}

 RUN mvn clean package \
 -DDB_HOST=$DB_HOST \
 -DDB_PORT=$DB_PORT \
 -DDB_NAME=$DB_NAME \
 -DDB_USERNAME=$DB_USERNAME \
 -DDB_PWD=$DB_PWD \
 -DAPP_PORT=$APP_PORT \
 -DAPP_DATA_MODE=$APP_DATA_MODE \
 -DAPP_DB=$APP_DB \
 -DAPP_DB_DRIVER=$APP_DB_DRIVER \
 -DAPP_DEBUG=$APP_DEBUG -DskipTests

 EXPOSE ${APP_PORT}

 FROM eclipse-temurin:22.0.1_8-jdk-alpine

 RUN mkdir -p /home/app

 COPY ./target/sigecap-0.0.1-SNAPSHOT.jar /home/app/app.jar

 WORKDIR /home/app

 EXPOSE ${APP_PORT}

 CMD ["java","-jar","app.jar"]